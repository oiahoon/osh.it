# OSH 改进路线图

## 🎯 改进优先级

### 🔥 **高优先级 (立即实施)**

#### 1. 安全问题修复
- [x] **Proxy插件安全问题** - 移除硬编码IP地址 ✅ **已完成**
  - 问题: proxy插件中硬编码了 `10.127.10.13:443`
  - 解决方案: 使用环境变量和用户配置文件
  - 状态: ✅ 已完成 (2025-07-03)

#### 2. 网络连接增强
- [x] **网络连接检测** ✅ **已完成**
  - 添加安装前网络连接检查
  - 支持多个测试URL
  - 提供网络问题诊断建议

- [x] **镜像源支持** ✅ **已完成**
  - 支持Gitee镜像源 (中国用户)
  - 支持自定义镜像源
  - 自动镜像源切换

#### 3. 依赖检查优化
- [x] **智能依赖检查** ✅ **已完成**
  - 区分必需依赖和推荐依赖
  - 提供OS特定的安装指导
  - 依赖版本检查

### 🚀 **中优先级 (近期实施)**

#### 4. 用户体验改进
- [ ] **插件预览功能**
  - 显示插件功能示例
  - 交互式插件演示
  - 插件依赖说明

- [ ] **配置向导**
  - 首次安装引导
  - Git配置检查和设置
  - Shell切换建议

- [ ] **进度可视化**
  - 进度条显示
  - 下载速度显示
  - 剩余时间估算

#### 5. 安装验证
- [ ] **安装完整性检查**
  - 核心文件验证
  - 插件加载测试
  - 配置文件检查

- [x] **健康检查命令** ✅ **已完成**
  - `osh doctor` 命令
  - 性能测试
  - 问题诊断和修复建议

### 💡 **低优先级 (长期规划)**

#### 6. 性能优化
- [ ] **并行下载**
  - 插件文件并行下载
  - 下载队列管理
  - 失败重试机制

- [ ] **缓存机制**
  - 插件清单缓存
  - 下载文件缓存
  - 智能缓存更新

#### 7. 高级功能
- [ ] **主题系统**
  - 可选择的视觉主题
  - 自定义颜色方案
  - 主题预览功能

- [ ] **国际化支持**
  - 多语言界面
  - 本地化错误消息
  - 区域特定配置

- [ ] **插件市场**
  - 在线插件浏览
  - 插件评分和评论
  - 一键安装第三方插件

## 📋 当前进行中的改进

### 🔒 Proxy插件安全修复

**问题描述**:
- proxy插件中硬编码了IP地址 `10.127.10.13:443`
- 这是安全风险，应该由用户自己配置

**解决方案**:
1. 移除硬编码IP地址
2. 使用环境变量 `OSH_PROXY_URL`
3. 创建用户配置文件 `~/.osh/config/proxy.conf`
4. 提供配置向导

**实施步骤**:
- [x] 分析当前代码
- [ ] 创建配置文件结构
- [ ] 修改proxy插件代码
- [ ] 添加配置向导
- [ ] 更新文档
- [ ] 测试验证

## 🛠️ 技术实现细节

### 网络连接检测
```bash
check_network_connectivity() {
  local test_urls=(
    "https://github.com"
    "https://raw.githubusercontent.com"
    "https://gitee.com"
  )
  # 实现逻辑...
}
```

### 镜像源支持
```bash
setup_mirror_source() {
  case "${OSH_MIRROR:-github}" in
    "github") OSH_REPO_BASE="https://raw.githubusercontent.com/oiahoon/osh/master" ;;
    "gitee") OSH_REPO_BASE="https://gitee.com/oiahoon/osh/raw/master" ;;
    "custom") OSH_REPO_BASE="$OSH_CUSTOM_REPO" ;;
  esac
}
```

### 依赖检查
```bash
check_dependencies() {
  local essential_deps=("curl" "git")
  local recommended_deps=("zsh" "python3")
  # 实现逻辑...
}
```

## 📊 进度跟踪

| 改进项目 | 优先级 | 状态 | 预计完成 |
|---------|--------|------|----------|
| Proxy安全修复 | 🔥 高 | ✅ 已完成 | 2025-07-03 |
| 网络连接检测 | 🔥 高 | ✅ 已完成 | 2025-07-03 |
| 镜像源支持 | 🔥 高 | ✅ 已完成 | 2025-07-03 |
| 依赖检查优化 | 🔥 高 | ✅ 已完成 | 2025-07-03 |
| 健康检查命令 | 🚀 中 | ✅ 已完成 | 2025-07-03 |
| 插件预览功能 | 🚀 中 | ⏳ 待开始 | 下周 |
| 配置向导 | 🚀 中 | ⏳ 待开始 | 2周后 |
| 进度可视化 | 🚀 中 | ⏳ 待开始 | 2周后 |
| 安装验证 | 🚀 中 | ⏳ 待开始 | 3周后 |

## 🎯 成功指标

### 用户体验指标
- [ ] 安装成功率 > 95%
- [ ] 用户满意度 > 4.5/5
- [ ] 安装时间 < 2分钟
- [ ] 错误恢复率 > 90%

### 技术指标
- [ ] 代码覆盖率 > 80%
- [ ] 安装脚本启动时间 < 3秒
- [ ] 网络超时处理 100%
- [ ] 跨平台兼容性 (macOS, Linux)

## 📝 更新日志

### 2025-07-03
- 创建改进路线图
- 识别proxy插件安全问题
- ✅ **完成proxy插件安全修复**:
  - 移除硬编码IP地址 `10.127.10.13:443`
  - 实现用户配置文件系统 (`~/.osh/config/proxy.conf`)
  - 添加配置向导 (`proxy_setup`)
  - 支持环境变量覆盖 (`OSH_PROXY_URL`)
  - 实现安全文件权限 (600)
  - 添加配置编辑和管理功能
  - 创建详细的插件文档

---

**维护者**: OSH开发团队  
**最后更新**: 2025-07-03  
**下次审查**: 2025-07-10

### 2025-07-03 (Proxy Plugin Removal)
- ✅ **移除proxy插件**: 
  - 插件不再被使用，已安全移除
  - 更新了所有相关文档和配置
  - 创建了完整的备份: ./proxy_removal_backup_20250703_143036
  - 更新了安装脚本和插件清单

### 2025-07-03 (Major Optimization Update)
- ✅ **网络连接增强完成**:
  - 实现安装前网络连接检查
  - 支持多个测试URL (GitHub, Gitee)
  - 自动镜像源选择 (基于响应时间)
  - 网络问题诊断和建议
  - 支持环境变量 `OSH_MIRROR` 和 `OSH_NETWORK_TIMEOUT`

- ✅ **依赖检查优化完成**:
  - 智能区分必需依赖 (curl, git) 和推荐依赖 (zsh, python3)
  - OS特定安装指导 (macOS Homebrew, Ubuntu/Debian apt, CentOS/RHEL yum)
  - 依赖版本显示和检查
  - 交互式确认继续安装

- ✅ **健康检查命令完成**:
  - 新增 `osh doctor` 命令，提供全面健康检查
  - 支持 `--fix` 自动修复常见问题
  - 支持 `--perf` 性能测试 (启动时间测量)
  - 支持 `--verbose` 详细输出
  - 检查项目：安装完整性、Zsh配置、shell配置、插件系统、依赖、网络连接
  - 健康评分系统和详细报告
  - 自动修复功能：shell配置、文件权限等

### 2025-07-03 (文档清理)
- ✅ **清理冗余文档**:
  - 归档临时文档: PROJECT_STATUS.md, GITIGNORE_UPDATES.md, PROXY_REMOVAL_SUMMARY.md
  - 归档冗余文档: INSTALLATION_GUIDE.md, PROJECT_STRUCTURE.md, DOCUMENTATION_INDEX.md
  - 创建文档归档目录: docs/archive/
  - 简化文档结构，保持根目录整洁
  - 备份位置: ./docs_cleanup_backup_20250703_143859
